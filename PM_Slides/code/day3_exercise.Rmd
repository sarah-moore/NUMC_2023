---
title: "Tidyverse Practice"
output: html_document
date: "2023-09-07"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(tidyverse)

```

# Tidyverse in Action

To practice the commands we learned, we will use (a sample) of the World Value Survey dataset. Because it is an .rds file, we will use a slightly different command:

```{r}
wvs5 <- readRDS("data/wvs5_wkshop.rds")
```

First, we will begin by selecting the variables we are interested in. Create a subset of this data that only has the following variables: COW, V114, V116, and V204. 

```{r}
wvs_ideology <- wvs5 %>% 
  select(COW, V114, V116, V204)
```

This is a short description of the variables:

- COW : Country Code 
- V114: Self positioning in political scale (1 = Left, 10 = Right)
- V116: Incomes more equal (1 = Incomes should be made more equal, 10 = We need larger income differences as incentives)
- V204: Abortion justifiable (1 = Always justifiable, 10 = Never justifiable)


Based on this description, we can rename the variables to make our code easier to interpret. Rename:

- COW to `country_code`

- V114 to `ideol_scale`

- V116 to `income_equal`

- V204 to `abort_justified`

```{r}
wvs_ideology <- wvs_ideology %>% 
  rename(country_code = COW,
         ideol_scale = V114,
         income_equal = V116,
         abort_justified = V204) 
```

Now, we will restrict our analysis to only a few set of countries. These are the countries we want to keep, with their corresponding COW code.

- US: 2
- Brazil:140
- Sweden: 380
- Zambia: 551
- Japan: 740
- Indonesia: 850


```{r}
wvs_ideology <- wvs_ideology %>% 
  filter(country_code  %in% c(2,140,551,740, 380,850))
```

Now, let's create a new variable name called `country_name` and give each country code an actual country name. Hint: use `case_when`. 

How many observations do we have for each country? (Hint: use `count`)


```{r}
wvs_ideology <- wvs_ideology %>% mutate(
  # insert new function here and then count observations 
)
```



## Exploring Ideology 

We are interested in understanding left-right ideology across countries, particularly how economic and social/cultural ideology differ. 

First, let's get draw a simple frequency table of the ideological scale across the whole dataset: 

```{r}
wvs_ideology %>% 
  count(ideol_scale)
```

Notice anything strange?

When we turn to the codebook, we will see that -5, -2, and -1 are Missing/No answer values. But, with the values they have now, they will distort our numerical analysis. We need to recode these as NAs. They are not actual values in the scale! 

Using `ifelse`, recode the negative values into NAs. 


```{r}
wvs_ideology <- wvs_ideology %>% 
  mutate(ideol_scale = ifelse(ideol_scale < 0, NA, ideol_scale))
```

Now, run a quick `count` again to make sure it has worked:

```{r}
wvs_ideology %>% count(ideol_scale)
```

It is likely that the other variables in the dataset also have NAs coded as negative values. Let's `glimpse` the dataset to see: 

```{r}
glimpse(wvs_ideology)
```

It can get repetitive to do this with every variable you want to work with. There are multiple ways of repeating this process across the whole dataset. Here is one suggestion:

```{r, eval = FALSE}
wvs_ideology <- wvs_ideology %>% 
  mutate(across(everything(), ~ ifelse(.x < 0, NA, .x)))

```

Note, though, that this *does* overwrite the original variables. So just be very sure that there is no risk in doing it. (Trying it out with a single variable beforehand is a good idea.)

If you only want to apply this to specific variables, you can use the `across` command instead of `mutate_all`. It would look something like this:

```{r}
wvs_ideology <- wvs_ideology %>% 
  mutate(across(c(income_equal,abort_justified), ~ ifelse(.x < 0, NA, .x)))
```

Now that we know we have complete cases, let's begin by getting a simple average of ideology in the left-right scale. If there are NAs in the dataset, we need to include a specification to the code above:

```{r}
wvs_ideology %>% summarize( 
  # mean of ideology 
  )
```

Now get the average left-right scale for each country. Hint:  use `group_by`

```{r}
wvs_ideology %>% 
  group_by(
    # fill in blank here 
  ) %>% 
  summarize(
    # fill in blank here 
)
```

Now let's add the average for `income_equal` and for `abort_justified`. With this simple compared average, we can already learn interesting things about ideology in these countries. 

```{r}
wvs_ideology %>% 
  group_by(country_name) %>% 
  summarize(mean_lr = mean(ideol_scale, na.rm=TRUE), 
            mean_income = mean(
              # fill in blank
            ),
            mean_abort = mean(
              # fill in blank 
            ))
```


