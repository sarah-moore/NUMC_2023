---
title: "Working in Rmarkdown"
author: "Sarah Moore"
date: "2023-09-11"
output: pdf_document
---

```{r setup, include=FALSE, warning=FALSE, message=F}
knitr::opts_chunk$set(echo = TRUE)
rm(list=ls())

# ipak function: https://gist.github.com/stevenworthington/3178163
ipak <- function(pkg){
  new.pkg <- pkg[!(pkg %in% installed.packages()[, "Package"])]
  if (length(new.pkg)) 
    install.packages(new.pkg, dependencies = TRUE)
  sapply(pkg, require, character.only = TRUE)
}

packages <- c("tidyverse", "paletteer", "xtable", "rnaturalearth", "rnaturalearthdata")

ipak(packages)


afri_sent <- read.csv("https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2023/2023-02-28/afrisenti.csv")
lang_countries <- read.csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2023/2023-02-28/language_countries.csv')
```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r, include = T, eval = T, echo = T, out.width="50%"}
afri_sent %>% 
  left_join(lang_countries, by = "language_iso_code", 
            relationship = "many-to-many")-> afri_sent_total

africa_map <- ne_countries(continent = "Africa", returnclass = "sf")

```

# Step 1
 
Here, write some text about what the dataset is. Consider adding some text that is **bold** and maybe some *italics*:

*Insert text here.*


In the following code chunk, identify the argument that specifies the output size of the figure. Change this to your preferred specification. 

```{r, echo = F, eval = T, out.width="60%"}
# You can't see this code chunk in the knitted pdf, but the code results show. Can you see the specifications that would entail this specification? 

afri_sent_total %>% 
  count(country) %>% 
  rename(count_senti = n)-> afrisent_count

afri_sent_total %>% 
  count(country, language_iso_code) %>% 
  group_by(country) %>% 
  mutate(max_language = ifelse(n == max(n), 1, 0)) %>% 
  filter(max_language == 1) %>% 
  rename(count_senti_major =n)-> afrisent_major

africa_map %>% 
  left_join(afrisent_count, by = c("geounit" = "country")) %>% 
    left_join(afrisent_major, by = c("geounit" = "country")) -> africa_map

ggplot(africa_map) +
  geom_sf(aes(fill = count_senti)) + 
  geom_text(aes(x = label_x, y = label_y, label = geounit)) + 
  theme_minimal() + 
  theme(line = element_blank(), 
        axis.text = element_blank(), 
        axis.title = element_blank()) +
  scale_fill_gradient(low = "white", high = "red", na.value = NA)


ggplot(africa_map) +
  geom_sf(aes(fill = count_senti)) + 
  geom_sf_text(data = sf::st_centroid(subset(africa_map, !is.na(count_senti))), 
               aes(x = label_x, y = label_y, label = geounit)) + 
  theme_minimal() + 
  theme(line = element_blank(), 
        axis.text = element_blank(), 
        axis.title = element_blank()) +
  scale_fill_gradient(low = "white", high = "red", na.value = NA,
                      name = "Count")


unique(africa_map$language_iso_code)
  
# meaning of labels is here: https://github.com/afrisenti-semeval/afrisent-semeval-2023

ggplot(africa_map) +
  geom_sf(aes(fill = count_senti)) + 
  geom_text(aes(x = label_x + 2, y = label_y, label = language_iso_code)) +
  theme_minimal() + 
  theme(line = element_blank(), 
        axis.text = element_blank(), 
        axis.title = element_blank()) +
  scale_fill_gradient(low = "white", high = "red", na.value = NA,
                      name = "Count")

africa_map %>% 
  mutate(language_name = 
    case_when(
      language_iso_code == "swa" ~ "Swahili", 
      language_iso_code == "tso" ~ "Xithonga", 
      language_iso_code == "hau" ~ "Hausa", 
      language_iso_code == "pt-MZ" ~ "Portuguese",
      language_iso_code == "arq" ~ "Arabic", 
      language_iso_code == "ary" ~ "Arabic", 
      language_iso_code == "amh" ~ "Amharic", 
      language_iso_code == "kin" ~ "Kinyarwanda"
    )
  )-> africa_map

```

**Knit** the document. 


# Step 2 


```{r, echo = F, eval = T}

#ggsave("africa_map.pdf", africa_map)

unique(afri_sent_total$label)

afri_sent_total %>% 
   mutate(polar_weight = ifelse(label %in% c("negative", "positive"), 1, -1), 
         valence_weight = ifelse(label == "negative", -1, 
                                 ifelse(label == "positive", 1, 0)))-> afri_sent_total

afri_sent_total %>% 
  group_by(country) %>% 
  summarize(polar_weight_total = sum(polar_weight, na.rm = T), 
            valence_weight_total = sum(valence_weight, na.rm = T), 
            country_total = n(), 
            polar_weight_prop = polar_weight_total/country_total, 
            valence_weight_prop = valence_weight_total/country_total) -> afri_sent_summary


afri_sent_summary %>% 
  ggplot(aes(x = polar_weight_prop, y = country)) + 
  geom_point() + 
  xlim(-1, 1) +
  theme_minimal() + 
  theme(text = element_text(size = 15)) + 
  labs(x = "Polar Weight", y = "Country", 
       title = "title")

afri_sent_summary %>% 
  ggplot(aes(x = valence_weight_prop, y = country)) + 
  geom_point() + 
  xlim(-1, 1) +
  theme_minimal() + 
  theme(text = element_text(size = 15)) + 
  labs(x = "Valence Weight", y = "Country", 
       title = "title") + 
  geom_vline(aes(xintercept = mean(afri_sent_summary$valence_weight_prop)), 
             lty = 2, color = "red")
```

Write here about what you think we have done so far with bullet points. 

- To do so: 

  - You can provide information like this. 
  
  - And make sure that you double skip between lines. 
  
      - And the lists nested with tabs.
      
1) Or you can make a numbered list. 

2) As an addition, write here a formula or equation you remember this week: 

  - To write in math notation in Markdown, you put your math "stuff" in betwen dollar signs. If you want it in the text, you just write it inline: $x + 2 = 44$. If you want it to be a line of its own you put it in double dollar signs, like this:
  
$$b = (X^TX)^{-1}X^TY$$

### Add a sub-subhead here that tells us what the formula that you provided is about. 

## KNIT AGAIN!!
